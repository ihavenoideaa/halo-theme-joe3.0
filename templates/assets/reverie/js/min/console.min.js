const consoleWrap=document.getElementById("r-console");let isAnimating=!1;function showConsole(){if(!isAnimating&&"none"===consoleWrap.style.display){isAnimating=!0,consoleWrap.style.removeProperty("display"),consoleWrap.classList.add("animated","showInUp");const e=()=>{consoleWrap.style.backgroundColor="#00000080",consoleWrap.classList.remove("showInUp"),consoleWrap.removeEventListener("animationend",e),isAnimating=!1};consoleWrap.addEventListener("animationend",e)}}function hideConsole(){if(!isAnimating&&"none"!==consoleWrap.style.display){isAnimating=!0,consoleWrap.offsetHeight,consoleWrap.classList.add("bounceOutRight"),consoleWrap.style.backgroundColor="transparent";const e=()=>{consoleWrap.style.display="none",consoleWrap.classList.remove("animated","bounceOutRight"),consoleWrap.removeEventListener("animationend",e),isAnimating=!1};consoleWrap.addEventListener("animationend",e)}}function switchConsole(){("none"===consoleWrap.style.display?showConsole:hideConsole)()}window.addEventListener("click",e=>{e.target===consoleWrap&&hideConsole()});class Pixel{constructor(e,t,s,i,n,o,a){this.width=e.width,this.height=e.height,this.ctx=t,this.x=s,this.y=i,this.color=n,this.speed=this.getRandomValue(.1,.9)*o,this.size=0,this.sizeStep=.4*Math.random(),this.minSize=.5,this.maxSizeInteger=2,this.maxSize=this.getRandomValue(this.minSize,this.maxSizeInteger),this.delay=a,this.counter=0,this.counterStep=4*Math.random()+.01*(this.width+this.height),this.isIdle=!1,this.isReverse=!1,this.isShimmer=!1}getRandomValue(e,t){return Math.random()*(t-e)+e}draw(){var e=.5*this.maxSizeInteger-.5*this.size;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+e,this.y+e,this.size,this.size)}appear(){this.isIdle=!1,this.counter<=this.delay?this.counter+=this.counterStep:(this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.draw())}disappear(){this.isShimmer=!1,this.counter=0,this.size<=0?this.isIdle=!0:(this.size-=.1,this.draw())}shimmer(){this.size>=this.maxSize?this.isReverse=!0:this.size<=this.minSize&&(this.isReverse=!1),this.isReverse?this.size-=this.speed:this.size+=this.speed}}class PixelCanvas extends HTMLElement{static register(e="pixel-canvas"){"customElements"in window&&customElements.define(e,this)}static css=`:host{display:grid;inline-size:100%;block-size:100%;overflow:hidden}`;get colors(){return this.dataset.colors?.split(",")||["#f8fafc","#f1f5f9","#cbd5e1"]}get gap(){var e=this.dataset.gap||5;return e<=4?4:50<=e?50:parseInt(e)}get speed(){var e=this.dataset.speed||35;return e<=0||this.reducedMotion?0:100<=e?.1:.001*parseInt(e)}get noFocus(){return this.hasAttribute("data-no-focus")}connectedCallback(){var e=document.createElement("canvas"),t=new CSSStyleSheet;this._parent=this.parentNode,this.shadowroot=this.attachShadow({mode:"open"}),t.replaceSync(PixelCanvas.css),this.shadowroot.adoptedStyleSheets=[t],this.shadowroot.append(e),this.canvas=this.shadowroot.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.timeInterval=1e3/60,this.timePrevious=performance.now(),this.reducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.init(),this.resizeObserver=new ResizeObserver(()=>this.init()),this.resizeObserver.observe(this),this._parent.addEventListener("mouseenter",this),this._parent.addEventListener("mouseleave",this),this.noFocus||(this._parent.addEventListener("focusin",this),this._parent.addEventListener("focusout",this))}disconnectedCallback(){this.resizeObserver.disconnect(),this._parent.removeEventListener("mouseenter",this),this._parent.removeEventListener("mouseleave",this),this.noFocus||(this._parent.removeEventListener("focusin",this),this._parent.removeEventListener("focusout",this)),delete this._parent}handleEvent(e){this["on"+e.type](e)}onmouseenter(){this.handleAnimation("appear")}onmouseleave(){this.handleAnimation("disappear")}onfocusin(e){e.currentTarget.contains(e.relatedTarget)||this.handleAnimation("appear")}onfocusout(e){e.currentTarget.contains(e.relatedTarget)||this.handleAnimation("disappear")}handleAnimation(e){cancelAnimationFrame(this.animation),this.animation=this.animate(e)}init(){var e=this.getBoundingClientRect(),t=Math.floor(e.width),e=Math.floor(e.height);this.pixels=[],this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.createPixels()}getDistanceToCanvasCenter(e,t){e-=this.canvas.width/2,t-=this.canvas.height/2;return Math.sqrt(e*e+t*t)}createPixels(){for(let t=0;t<this.canvas.width;t+=this.gap)for(let e=0;e<this.canvas.height;e+=this.gap){var s=this.colors[Math.floor(Math.random()*this.colors.length)],i=this.reducedMotion?0:this.getDistanceToCanvasCenter(t,e);this.pixels.push(new Pixel(this.canvas,this.ctx,t,e,s,this.speed,i))}}animate(t){this.animation=requestAnimationFrame(()=>this.animate(t));var e=performance.now(),s=e-this.timePrevious;if(!(s<this.timeInterval)){this.timePrevious=e-s%this.timeInterval,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e=0;e<this.pixels.length;e++)this.pixels[e][t]();this.pixels.every(e=>e.isIdle)&&cancelAnimationFrame(this.animation)}}}function swtichSidebar(){document.querySelector(".joe_main_container").classList.toggle("revert")}function swtichBackgroud(){document.body.classList.toggle("console-no-bg")}PixelCanvas.register();let nowMusicIndex=-1,isMusicStop=!0,consoleAplayer;function musicInit(){return!!(consoleAplayer=document.querySelector("meting-js")?.aplayer)&&(consoleAplayer.list.clear(),consoleMusics.forEach(e=>{consoleAplayer.list.add([{name:e.realNode.music_name,artist:e.realNode.music_artist,url:e.realNode.music_url,cover:e.realNode.music_cover||"",lrc:e.realNode.music_lrc||"/res/files/pure_music.lrc",theme:"#ebd0c2"}])}),consoleAplayer.volume(.15,!1),consoleAplayer.on("ended",function(){musicSwitchEvent((nowMusicIndex+1)%consoleMusics.length)}),consoleAplayer.on("pause",function(){musicPauseEvent()}),consoleAplayer.on("play",function(){-1!==nowMusicIndex&&musicRePlayEvent()}),!0)}function musicPlay(e,t){-1===nowMusicIndex?!1===musicInit()?console.error("控制面板音乐播放器初始化失败"):musicStart(t):nowMusicIndex===t?(isMusicStop?musicPause:musicRePlay)():musicSwitch(t)}function musicStart(e){consoleAplayer.list.switch(e),document.getElementById("nav-music-hoverTips").click(),nowMusicIndex=e,musicStartEvent()}function musicPause(){consoleAplayer.pause()}function musicRePlay(){consoleAplayer.play()}function musicSwitch(e){consoleAplayer.pause(),consoleAplayer.list.switch(e),consoleAplayer.play(),musicSwitchEvent(e)}function musicStartEvent(){document.getElementById("start-"+nowMusicIndex).classList="hidding",document.getElementById("playing-"+nowMusicIndex).classList="showing"}function musicPauseEvent(){document.getElementById("pause-"+nowMusicIndex).classList="showing",document.getElementById("playing-"+nowMusicIndex).classList="hidding",isMusicStop=!1}function musicRePlayEvent(){document.getElementById("pause-"+nowMusicIndex).classList="hidding",document.getElementById("playing-"+nowMusicIndex).classList="showing",isMusicStop=!0}function musicSwitchEvent(e){document.getElementById("pause-"+nowMusicIndex).classList="hidding",document.getElementById("playing-"+nowMusicIndex).classList="hidding",document.getElementById("start-"+nowMusicIndex).classList="hovering",nowMusicIndex=e,isMusicStop=!0,document.getElementById("start-"+e).classList="hidding",document.getElementById("playing-"+e).classList="showing"}document.addEventListener("DOMContentLoaded",function(){{window.encryption=e=>window.btoa(unescape(encodeURIComponent(e))),window.decrypt=e=>decodeURIComponent(escape(window.atob(e)));var e=document.querySelectorAll(".console-post-like");let c=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[];e.forEach(e=>{const i=e.dataset.cid;let n=c.includes(i);const t=e.querySelector(".r-underline");e=e.querySelector(".console-icon-wrap");const o=e.querySelector(".console-icon-like"),a=e.querySelector(".console-icon-liked");(n?a:o).classList.add("active"),e.addEventListener("click",function(e){e.stopPropagation(),n||$.ajax({url:"/apis/api.halo.run/v1alpha1/trackers/upvote",type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify({group:"content.halo.run",plural:"posts",name:i})}).then(e=>{console.log("like++"),c.push(i),o.classList.remove("active"),a.classList.add("active");var t=encryption("agree"),s=encryption(JSON.stringify(c));localStorage.setItem(t,s),n=!0}).catch(e=>{_loading=!1})}),e.addEventListener("mouseenter",function(){t.style.color="#fff"}),e.addEventListener("mouseleave",function(){t.style.removeProperty("color")})})}});